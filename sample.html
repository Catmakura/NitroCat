<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Battery Status API å…¨æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f8f9fa;
      color: #333;
      padding: 2rem;
    }
    #battery-info {
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 500px;
    }
    h1 { color: #0078d7; }
    .value { font-weight: bold; color: #222; }
    .charging { color: green; }
    .discharging { color: red; }
    .log {
      margin-top: 1.5rem;
      font-size: 0.9rem;
      background: #f0f0f0;
      padding: 0.8rem;
      border-radius: 6px;
      height: 150px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ”‹ Battery Status API å…¨æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯</h1>
  <div id="battery-info">ãƒãƒƒãƒ†ãƒªãƒ¼æƒ…å ±ã‚’å–å¾—ä¸­...</div>
  <div class="log" id="log"></div>

  <script>
    function logEvent(msg) {
      const log = document.getElementById("log");
      const time = new Date().toLocaleTimeString();
      log.innerHTML += `[${time}] ${msg}<br>`;
      log.scrollTop = log.scrollHeight;
    }

    if ('getBattery' in navigator) {
      navigator.getBattery().then(battery => {
        const infoDiv = document.getElementById("battery-info");

        function updateBatteryInfo() {
          const level = Math.round(battery.level * 100);
          const charging = battery.charging;
          const chargingTime = battery.chargingTime;
          const dischargingTime = battery.dischargingTime;

          const chargeState = charging ? "âš¡ å……é›»ä¸­" : "ğŸ”‹ ãƒãƒƒãƒ†ãƒªãƒ¼ä½¿ç”¨ä¸­";
          const timeText = `
            å……é›»å®Œäº†ã¾ã§: ${
              chargingTime === Infinity ? "N/A" : (chargingTime / 60).toFixed(1) + " åˆ†"
            }<br>
            æ®‹ã‚Šä½¿ç”¨æ™‚é–“: ${
              dischargingTime === Infinity ? "N/A" : (dischargingTime / 60).toFixed(1) + " åˆ†"
            }
          `;

          infoDiv.innerHTML = `
            <div>çŠ¶æ…‹: <span class="value ${charging ? 'charging' : 'discharging'}">${chargeState}</span></div>
            <div>ãƒãƒƒãƒ†ãƒªãƒ¼æ®‹é‡: <span class="value">${level}%</span></div>
            <div>${timeText}</div>
          `;
        }

        // åˆå›è¡¨ç¤º
        updateBatteryInfo();

        // å„ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–
        battery.addEventListener('chargingchange', () => {
          logEvent(`å……é›»çŠ¶æ…‹ãŒå¤‰åŒ–ã—ã¾ã—ãŸ â†’ ${battery.charging ? "å……é›»é–‹å§‹" : "æ”¾é›»ä¸­"}`);
          updateBatteryInfo();
        });

        battery.addEventListener('levelchange', () => {
          logEvent(`ãƒãƒƒãƒ†ãƒªãƒ¼æ®‹é‡ãŒå¤‰åŒ–ã—ã¾ã—ãŸ â†’ ${Math.round(battery.level * 100)}%`);
          updateBatteryInfo();
        });

        battery.addEventListener('chargingtimechange', () => {
          logEvent(`å……é›»å®Œäº†ã¾ã§ã®æ™‚é–“ãŒå¤‰åŒ–ã—ã¾ã—ãŸ â†’ ${battery.chargingTime}s`);
          updateBatteryInfo();
        });

        battery.addEventListener('dischargingtimechange', () => {
          logEvent(`æ®‹ã‚Šä½¿ç”¨æ™‚é–“ãŒå¤‰åŒ–ã—ã¾ã—ãŸ â†’ ${battery.dischargingTime}s`);
          updateBatteryInfo();
        });

      }).catch(err => {
        document.getElementById("battery-info").innerHTML =
          "âš ï¸ ãƒãƒƒãƒ†ãƒªãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>" + err;
      });
    } else {
      document.getElementById("battery-info").innerHTML =
        "âŒ ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ Battery Status API ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚";
    }
  </script>
</body>
</html>

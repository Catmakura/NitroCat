<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mini Scratch with Menu</title>
<style>
body { margin:0; font-family: sans-serif; }

/* ==== メニューバー ==== */
#menubar {
    background:#333;
    color:white;
    display:flex;
    gap:20px;
    padding:10px;
    font-size:14px;
}
#menubar div {
    cursor:pointer;
}

/* ==== レイアウト ==== */
#main {
    display:flex;
    gap:20px;
    padding:20px;
}

#palette, #script {
    width: 200px;
    padding: 10px;
    border: 2px solid #444;
    min-height: 300px;
}
.block {
    background: #4db7ff;
    padding: 10px;
    margin: 5px 0;
    cursor: grab;
    color: white;
    border-radius: 8px;
}
#run { height: 40px; }

#stage {
    width:200px; height:200px;
    border:1px solid #888;
    position:relative;
}
#sprite {
    width:30px;height:30px;
    background:red;
    position:absolute;
    left:80px; top:80px;
}
</style>
</head>
<body>

<!-- === メニューバー === -->
<div id="menubar">
    <div onclick="alert('新規ファイル')">ファイル</div>
    <div onclick="alert('編集メニュー')">編集</div>
    <div onclick="alert('実行メニュー')">実行</div>
    <div onclick="alert('ヘルプメニュー')">ヘルプ</div>
</div>

<!-- === メイン画面 === -->
<div id="main">
    <div>
        <h3>ブロック</h3>
        <div id="palette">
            <div class="block" draggable="true" data-code="move()">10 歩動かす</div>
            <div class="block" draggable="true" data-code="turn()">15 度回す</div>
            <div class="block" draggable="true" data-code='say("こんにちは")'>言う「こんにちは」</div>
        </div>
    </div>

    <div>
        <h3>スクリプト</h3>
        <div id="script"></div>
        <button id="run">▶ 実行</button>
    </div>

    <div>
        <h3>キャラクター</h3>
        <div id="stage">
            <div id="sprite"></div>
        </div>
    </div>
</div>

<script>
// ==== ドラッグ処理 ====
document.querySelectorAll('.block').forEach(b=>{
    b.addEventListener('dragstart', e=>{
        e.dataTransfer.setData("text", e.target.dataset.code);
    });
});

document.getElementById('script').addEventListener('dragover', e=> e.preventDefault());
document.getElementById('script').addEventListener('drop', e=>{
    e.preventDefault();
    const code = e.dataTransfer.getData("text");
    const newBlock = document.createElement("div");
    newBlock.className = "block";
    newBlock.textContent = code;
    newBlock.dataset.code = code;
    document.getElementById("script").appendChild(newBlock);
});

// ==== スプライト制御 ====
let x = 80, y = 80, angle = 0;
const sprite = document.getElementById("sprite");

function move() {
    x += 10 * Math.cos(angle * Math.PI / 180);
    y += 10 * Math.sin(angle * Math.PI / 180);
    sprite.style.left = x + "px";
    sprite.style.top = y + "px";
}

function turn() {
    angle += 15;
    sprite.style.transform = `rotate(${angle}deg)`;
}

function say(msg) {
    alert(msg);
}

// ==== 実行ボタン ====
document.getElementById('run').onclick = ()=>{
    const blocks = document.querySelectorAll("#script .block");
    blocks.forEach(b=>{
        eval(b.dataset.code); // 簡易実装のため eval 使用
    });
};
</script>

</body>
</html>

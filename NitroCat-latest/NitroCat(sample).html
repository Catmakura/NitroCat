<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ファイル上書き編集ツール</title>
</head>
<body>

<h2>ファイルを直接編集して上書き保存する</h2>

<button id="openBtn">ファイルを開く</button>
<button id="saveBtn" disabled>上書き保存</button>
<br><br>

<textarea id="editor" rows="15" cols="60" placeholder="ここに内容が表示されます"></textarea>

<script>
let fileHandle = null;

// ① ファイルを開く
document.getElementById("openBtn").onclick = async () => {
    // ファイル選択ダイアログを開く
    [fileHandle] = await window.showOpenFilePicker({
        types: [{
            description: 'Text Files',
            accept: { 'text/plain': ['.txt', '.csv', '.json'] }
        }]
    });

    const file = await fileHandle.getFile();
    const contents = await file.text();

    document.getElementById("editor").value = contents;
    document.getElementById("saveBtn").disabled = false;
};

// ② 上書き保存
document.getElementById("saveBtn").onclick = async () => {
    if (!fileHandle) return;

    const writable = await fileHandle.createWritable();

    // textarea の内容を書き込む
    await writable.write(document.getElementById("editor").value);

    // 完了（これでローカルファイルが上書きされる）
    await writable.close();

    alert("上書き保存しました！");
};
</script>

</body>
</html>
